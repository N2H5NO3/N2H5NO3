<!DOCTYPE html>
<html>
<head>
    <title>3人共享文件站 (Word/PDF)</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .file-list { margin-top: 20px; }
        .file-item { padding: 10px; border: 1px solid #ddd; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>共享文件上传站</h1>
    <p>支持 Word/PDF（通过 GitHub 存储）</p>

    <!-- 文件上传表单 -->
    <input type="file" id="fileInput" accept=".doc,.docx,.pdf">
    <button onclick="uploadFile()">上传</button>

    <!-- 文件列表 -->
    <div id="fileList" class="file-list"></div>

    <script>
        // 配置你的 GitHub 信息（修改这里！）
        const GITHUB_USER = "你的GitHub用户名";
        const REPO_NAME = "simple-notes";
        const FOLDER_NAME = "files"; // 存文件的文件夹
        const GITHUB_TOKEN = "你的GitHub_TOKEN"; // 需手动生成

        // 上传文件到 GitHub
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert("请选择文件！");
                return;
            }

            // 检查文件类型
            const validTypes = ["application/pdf", "application/msword", "application/vnd.openxmlformats-officedocument.wordprocessingml.document"];
            if (!validTypes.includes(file.type)) {
                alert("仅支持 PDF 或 Word 文件！");
                return;
            }

            // 转为 Base64
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64Data = reader.result.split(',')[1];
                const fileName = file.name;
                const filePath = `${FOLDER_NAME}/${fileName}`;

                // 调用 GitHub API 上传
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents/${filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: `上传文件: ${fileName}`,
                            content: base64Data,
                        }),
                    }
                );

                if (response.ok) {
                    alert("文件已上传！");
                    loadFiles();
                } else {
                    alert("上传失败，检查 TOKEN 权限！");
                }
            };
        }

        // 从 GitHub 加载文件列表
        async function loadFiles() {
            const response = await fetch(
                `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents/${FOLDER_NAME}`,
                { headers: { 'Authorization': `token ${GITHUB_TOKEN}` } }
            );

            if (!response.ok) {
                document.getElementById('fileList').innerHTML = "无法加载文件列表";
                return;
            }

            const files = await response.json();
            let html = '<h3>共享文件列表</h3>';
            files.forEach(file => {
                html += `
                    <div class="file-item">
                        <a href="${file.download_url}" target="_blank">${file.name}</a>
                    </div>
                `;
            });
            document.getElementById('fileList').innerHTML = html;
        }

        // 初始化加载
        loadFiles();
    </script>
</body>
</html>
